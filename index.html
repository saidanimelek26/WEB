<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebADB Pro GUI</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/webadb/webadb.js@master/dist/webadb.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #10b981;
      --dark-bg: #1f2937;
      --darker-bg: #111827;
      --light-bg: #f9fafb;
      --lighter-bg: #ffffff;
      --text-dark: #1f2937;
      --text-light: #f9fafb;
      --border-dark: #374151;
      --border-light: #e5e7eb;
    }

    body {
      transition: all 0.3s ease;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
    
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    
    .window {
      resize: both;
      overflow: auto;
      min-width: 500px;
      min-height: 600px;
      max-width: 90vw;
      max-height: 85vh;
      background: var(--lighter-bg);
      border: 1px solid var(--border-light);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      border-radius: 12px;
    }
    
    .dark .window {
      background: var(--darker-bg);
      border: 1px solid var(--border-dark);
    }
    
    .draggable-header {
      cursor: move;
      user-select: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    
    .scrollbar-custom::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(229, 231, 235, 0.4);
      border-radius: 4px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(107, 114, 128, 0.6);
      border-radius: 4px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(75, 85, 99, 0.8);
    }
    
    .dark .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(31, 41, 55, 0.4);
    }
    
    .dark .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(156, 163, 175, 0.6);
    }
    
    .dark .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(209, 213, 219, 0.8);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
    }
    
    .dark .glass-effect {
      background: rgba(31, 41, 55, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      transition: all 0.2s ease;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--primary-dark), #4338ca);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--secondary), #059669);
      color: white;
      transition: all 0.2s ease;
    }
    
    .btn-success:hover:not(:disabled) {
      background: linear-gradient(135deg, #059669, #047857);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
    }
    
    .status-connected {
      color: var(--secondary);
      font-weight: 600;
    }
    
    .status-disconnected {
      color: #ef4444;
      font-weight: 600;
    }
    
    .output-terminal {
      background: var(--dark-bg);
      color: var(--text-light);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      border-radius: 8px;
      padding: 1rem;
      height: 220px;
      overflow: auto;
    }
    
    .history-panel {
      max-height: 120px;
      overflow-y: auto;
    }
    
    .tab-active {
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
      font-weight: 600;
    }
    
    .dark .tab-active {
      color: var(--primary-dark);
      border-bottom: 2px solid var(--primary-dark);
    }

    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-indigo-900 dark:to-purple-900 transition-colors duration-300 min-h-screen">
  <div id="root"></div>
  <script>
    const { useState, useEffect, useRef } = React;

    function App() {
      const [deviceStatus, setDeviceStatus] = useState("Disconnected");
      const [output, setOutput] = useState("");
      const [adb, setAdb] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState("");
      const [commandHistory, setCommandHistory] = useState([]);
      const [darkMode, setDarkMode] = useState(false); // Default to light mode
      const [activeTab, setActiveTab] = useState("info");
      const windowRef = useRef(null);

      useEffect(() => {
        document.body.classList.toggle("dark", darkMode);
        localStorage.setItem("theme", darkMode ? "dark" : "light");
      }, [darkMode]);

      useEffect(() => {
        const window = windowRef.current;
        if (!window) return;
        let offsetX, offsetY;
        const handleDrag = (e) => {
          if (e.target.classList.contains("draggable-header")) {
            e.preventDefault();
            offsetX = e.clientX - window.offsetLeft;
            offsetY = e.clientY - window.offsetTop;
            const onMouseMove = (e) => {
              const maxX = window.innerWidth - window.offsetWidth;
              const maxY = window.innerHeight - window.offsetHeight;
              window.style.left = `${Math.max(0, Math.min(e.clientX - offsetX, maxX))}px`;
              window.style.top = `${Math.max(0, Math.min(e.clientY - offsetY, maxY))}px`;
              window.style.transform = "none";
            };
            document.addEventListener("mousemove", onMouseMove);
            document.addEventListener("mouseup", () => document.removeEventListener("mousemove", onMouseMove), { once: true });
          }
        };
        window.addEventListener("mousedown", handleDrag);
        return () => window.removeEventListener("mousedown", handleDrag);
      }, []);

      const connectDevice = async () => {
        setLoading(true);
        setError("");
        try {
          const webusb = await Adb.open("WebUSB");
          const adbConnection = await webusb.connectAdb("host::");
          setAdb(adbConnection);
          setDeviceStatus("Connected");
          setOutput("Device connected successfully. Click 'Read Device Info' to view details.");
        } catch (err) {
          setError(`Connection failed: ${err.message}. Ensure USB debugging is enabled and device is connected via USB.`);
          setDeviceStatus("Disconnected");
          setOutput("");
        } finally {
          setLoading(false);
        }
      };

      const runReadInfo = async () => {
        if (!adb) {
          setError("No device connected. Please connect a device first.");
          return;
        }
        setLoading(true);
        setError("");
        const command = "getprop";
        try {
          const shell = await adb.shell(command);
          const result = await new Promise((resolve, reject) => {
            shell.receive().then(resolve).catch(reject);
          });
          const outputText = typeof result === "string" ? result : result.data || "No device info received.";
          setOutput(outputText);
          setCommandHistory((prev) => [
            ...prev.slice(-5),
            { command, output: outputText, timestamp: new Date().toLocaleTimeString() },
          ]);
        } catch (err) {
          setError(`Failed to read device info: ${err.message}`);
          setOutput(`Error: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      return React.createElement(
        "div",
        { className: "min-h-screen flex items-center justify-center p-4" },
        React.createElement(
          "div",
          {
            ref: windowRef,
            className: "window animate-fadeIn",
            style: { position: "absolute", top: "5%", left: "50%", transform: "translateX(-50%)" },
          },
          React.createElement(
            "div",
            { className: "draggable-header p-4 flex justify-between items-center" },
            React.createElement(
              "div",
              { className: "flex items-center space-x-2" },
              React.createElement("div", { className: "w-6 h-6 rounded-full bg-white/20 flex items-center justify-center" }, "🔧"),
              React.createElement("span", { className: "font-bold text-lg text-white" }, "WebADB Pro")
            ),
            React.createElement(
              "div",
              { className: "flex items-center space-x-3" },
              React.createElement(
                "button",
                {
                  onClick: () => setDarkMode(!darkMode),
                  className: "p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-300 text-white",
                  title: darkMode ? "Switch to light mode" : "Switch to dark mode",
                },
                darkMode ? "☀️" : "🌙"
              )
            )
          ),
          React.createElement(
            "div",
            { className: "p-6 flex flex-col h-full" },
            React.createElement(
              "div",
              { className: "flex justify-between items-center mb-6" },
              React.createElement(
                "button",
                {
                  onClick: connectDevice,
                  disabled: loading || deviceStatus === "Connected",
                  className: `px-6 py-3 rounded-lg font-semibold transition-all duration-300 ${
                    deviceStatus === "Connected" ? "btn-success" : "btn-primary animate-pulse"
                  } disabled:opacity-50 flex items-center`,
                },
                loading
                  ? React.createElement("span", { className: "loading-spinner mr-2" })
                  : null,
                deviceStatus === "Connected" ? "Connected" : loading ? "Connecting..." : "Connect Device"
              ),
              React.createElement(
                "div",
                { className: "flex items-center" },
                React.createElement("div", {
                  className: `w-3 h-3 rounded-full mr-2 ${deviceStatus === "Connected" ? "bg-green-500" : "bg-red-500"}`,
                }),
                React.createElement(
                  "span",
                  { className: `text-lg font-medium ${deviceStatus === "Connected" ? "status-connected" : "status-disconnected"}` },
                  `Status: ${deviceStatus}`
                )
              )
            ),
            error && React.createElement(
              "div",
              { className: "mb-6" },
              React.createElement(
                "div",
                { className: "p-3 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-lg" },
                React.createElement("p", { className: "text-red-700 dark:text-red-300" }, error)
              )
            ),
            React.createElement(
              "div",
              { className: "mb-6 flex border-b border-gray-200 dark:border-gray-700" },
              ["info", "shell", "files"].map((tab) =>
                React.createElement(
                  "button",
                  {
                    key: tab,
                    onClick: () => setActiveTab(tab),
                    className: `tab-button px-4 py-2 font-medium ${
                      activeTab === tab
                        ? "tab-active"
                        : "text-gray-500 dark:text-gray-400"
                    }`,
                  },
                  tab === "info" ? "Device Info" : tab === "shell" ? "Shell" : "File Manager"
                )
              )
            ),
            React.createElement(
              "div",
              { className: "tab-content" },
              React.createElement(
                "div",
                { className: `tab-content ${activeTab === "info" ? "active" : "hidden"}` },
                React.createElement(
                  "div",
                  { className: "mb-6" },
                  React.createElement(
                    "button",
                    {
                      onClick: runReadInfo,
                      disabled: loading || !adb,
                      className:
                        "w-full px-6 py-4 glass-effect rounded-lg text-lg font-semibold text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",
                    },
                    loading
                      ? React.createElement("span", { className: "loading-spinner mr-2" })
                      : null,
                    loading ? "Reading..." : "Read Device Info"
                  )
                ),
                React.createElement(
                  "div",
                  { className: "flex-1 mb-6" },
                  React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "Output"),
                  React.createElement(
                    "pre",
                    { className: "output-terminal scrollbar-custom" },
                    output || "Connect a device and click 'Read Device Info' to view details."
                  )
                )
              ),
              React.createElement(
                "div",
                { className: `tab-content ${activeTab === "shell" ? "active" : "hidden"}` },
                React.createElement(
                  "div",
                  { className: "flex-1 mb-6" },
                  React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "ADB Shell"),
                  React.createElement(
                    "div",
                    { className: "glass-effect rounded-lg p-4 mb-4" },
                    React.createElement("p", { className: "text-gray-700 dark:text-gray-300 mb-4" }, "Shell functionality coming soon..."),
                    React.createElement(
                      "div",
                      { className: "flex" },
                      React.createElement("input", {
                        type: "text",
                        disabled: true,
                        placeholder: "Enter shell command...",
                        className: "flex-1 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-l-lg text-gray-900 dark:text-gray-100",
                      }),
                      React.createElement(
                        "button",
                        { disabled: true, className: "px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 rounded-r-lg cursor-not-allowed" },
                        "Execute"
                      )
                    )
                  )
                )
              ),
              React.createElement(
                "div",
                { className: `tab-content ${activeTab === "files" ? "active" : "hidden"}` },
                React.createElement(
                  "div",
                  { className: "flex-1 mb-6" },
                  React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "File Manager"),
                  React.createElement(
                    "div",
                    { className: "glass-effect rounded-lg p-4 h-48 flex items-center justify-center" },
                    React.createElement("p", { className: "text-gray-700 dark:text-gray-300" }, "File manager functionality coming soon...")
                  )
                )
              )
            ),
            React.createElement(
              "div",
              { className: "mt-auto" },
              React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "History"),
              React.createElement(
                "div",
                { className: "glass-effect rounded-lg p-4 history-panel scrollbar-custom" },
                commandHistory.length === 0
                  ? React.createElement("p", { className: "text-gray-500 dark:text-gray-400" }, "No device info fetched yet.")
                  : commandHistory.map((entry, index) =>
                      React.createElement(
                        "div",
                        { key: index, className: "mb-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700" },
                        React.createElement(
                          "div",
                          { className: "flex justify-between items-center mb-1" },
                          React.createElement("span", { className: "text-sm font-semibold text-gray-900 dark:text-gray-100" }, "getprop"),
                          React.createElement("span", { className: "text-xs text-gray-500 dark:text-gray-400" }, entry.timestamp)
                        ),
                        React.createElement(
                          "pre",
                          { className: "text-xs text-gray-600 dark:text-gray-300 truncate" },
                          entry.output.slice(0, 80) + (entry.output.length > 80 ? "..." : "")
                        )
                      )
                    )
              )
            )
          )
        )
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById("root"));
  </script>
</body>
</html>
