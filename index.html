<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebADB Pro GUI</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/webadb/webadb.js@master/webadb.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.js"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    .window {
      resize: both;
      overflow: auto;
      min-width: 400px;
      min-height: 500px;
      max-width: 90vw;
      max-height: 85vh;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    }
    .dark .window {
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .draggable-header {
      cursor: move;
      user-select: none;
      background: linear-gradient(135deg, #1e3a8a, #7e22ce);
    }
    .scrollbar-custom::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(229, 231, 235, 0.4);
    }
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(107, 114, 128, 0.6);
      border-radius: 4px;
    }
    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(75, 85, 99, 0.8);
    }
    .dark .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(31, 41, 55, 0.4);
    }
    .dark .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(156, 163, 175, 0.6);
    }
    .dark .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(209, 213, 219, 0.8);
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(6px);
    }
    .dark .glass-effect {
      background: rgba(31, 41, 55, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-indigo-900 dark:to-purple-900 transition-colors duration-500">
  <div id="root"></div>
  <script>
    const { useState, useEffect, useRef } = React;

    function App() {
      const [deviceStatus, setDeviceStatus] = useState("Disconnected");
      const [output, setOutput] = useState("");
      const [adb, setAdb] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState("");
      const [commandHistory, setCommandHistory] = useState([]);
      const [darkMode, setDarkMode] = useState(true);
      const windowRef = useRef(null);

      useEffect(() => {
        document.body.classList.toggle("dark", darkMode);
        localStorage.setItem("theme", darkMode ? "dark" : "light");
      }, [darkMode]);

      useEffect(() => {
        const window = windowRef.current;
        if (!window) return;
        let offsetX, offsetY;
        const handleDrag = (e) => {
          if (e.target.classList.contains("draggable-header")) {
            e.preventDefault();
            offsetX = e.clientX - window.offsetLeft;
            offsetY = e.clientY - window.offsetTop;
            const onMouseMove = (e) => {
              window.style.left = `${e.clientX - offsetX}px`;
              window.style.top = `${e.clientY - offsetY}px`;
            };
            document.addEventListener("mousemove", onMouseMove);
            document.addEventListener("mouseup", () => document.removeEventListener("mousemove", onMouseMove), { once: true });
          }
        };
        window.addEventListener("mousedown", handleDrag);
        return () => window.removeEventListener("mousedown", handleDrag);
      }, []);

      const connectDevice = async () => {
        setLoading(true);
        setError("");
        try {
          const webusb = await Adb.open("WebUSB");
          const adbConnection = await webusb.connectAdb("host::");
          setAdb(adbConnection);
          setDeviceStatus("Connected");
          setOutput("Device connected successfully. Click 'Read Info' to view device details.");
        } catch (err) {
          setError(`Connection failed: ${err.message}. Ensure USB debugging is enabled and device is connected via USB.`);
          setDeviceStatus("Disconnected");
          setOutput("");
        } finally {
          setLoading(false);
        }
      };

      const runReadInfo = async () => {
        if (!adb) {
          setError("No device connected. Please connect a device first.");
          setLoading(false);
          return;
        }
        setLoading(true);
        setError("");
        const command = "getprop";
        try {
          const shell = await adb.shell(command);
          const result = await new Promise((resolve, reject) => {
            shell.receive().then(resolve).catch(reject);
          });
          const outputText = typeof result === "string" ? result : result.data || "No device info received.";
          setOutput(outputText);
          setCommandHistory((prev) => [
            ...prev.slice(-9),
            { command, output: outputText, timestamp: new Date().toLocaleTimeString() },
          ]);
        } catch (err) {
          setError(`Failed to read device info: ${err.message}`);
          setOutput(`Error: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      return React.createElement(
        "div",
        { className: "min-h-screen flex items-center justify-center p-6" },
        React.createElement(
          "div",
          {
            ref: windowRef,
            className: "window rounded-2xl w-[700px] h-[600px] relative animate-fadeIn",
            style: { position: "absolute", top: "5%", left: "50%", transform: "translateX(-50%)" },
          },
          React.createElement(
            "div",
            { className: "draggable-header rounded-t-2xl text-white p-4 flex justify-between items-center" },
            React.createElement("span", { className: "font-bold text-xl" }, "WebADB Pro"),
            React.createElement(
              "div",
              null,
              React.createElement(
                "button",
                {
                  onClick: () => setDarkMode(!darkMode),
                  className: "p-2 rounded-full hover:bg-white/20 transition-all duration-300",
                  title: darkMode ? "Switch to Light Mode" : "Switch to Dark Mode",
                },
                darkMode ? "‚òÄÔ∏è" : "üåô"
              )
            )
          ),
          React.createElement(
            "div",
            { className: "p-8 flex flex-col h-full" },
            React.createElement(
              "div",
              { className: "flex justify-between items-center mb-8" },
              React.createElement(
                "button",
                {
                  onClick: connectDevice,
                  disabled: loading || deviceStatus === "Connected",
                  className: `px-8 py-3 rounded-lg font-semibold text-white transition-all duration-300 bg-gradient-to-r ${
                    deviceStatus === "Connected"
                      ? "from-green-500 to-green-600"
                      : "from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700"
                  } disabled:opacity-50 animate-pulse`,
                },
                loading ? "Connecting..." : deviceStatus === "Connected" ? "Connected" : "Connect Device"
              ),
              React.createElement(
                "span",
                { className: `text-lg font-medium ${deviceStatus === "Connected" ? "text-green-500" : "text-red-500"}` },
                `Status: ${deviceStatus}`
              )
            ),
            error && React.createElement("p", { className: "text-lg text-red-500 mb-8 animate-fadeIn" }, error),
            React.createElement(
              "div",
              { className: "mb-8" },
              React.createElement("h2", { className: "text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-4" }, "Device Info"),
              React.createElement(
                "button",
                {
                  onClick: runReadInfo,
                  disabled: loading || !adb,
                  className:
                    "w-full px-8 py-4 glass-effect rounded-lg text-lg font-semibold text-gray-900 dark:text-gray-100 hover:bg-white/20 dark:hover:bg-gray-700/20 transition-all duration-300 disabled:opacity-50 animate-fadeIn",
                },
                "Read Device Info"
              )
            ),
            React.createElement(
              "div",
              { className: "flex-1" },
              React.createElement("h2", { className: "text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-4" }, "Output"),
              React.createElement(
                "pre",
                { className: "bg-gray-800 text-gray-100 p-6 rounded-lg h-[220px] overflow-auto scrollbar-custom font-mono text-base" },
                output || "Connect a device and click 'Read Device Info' to view details."
              )
            ),
            React.createElement(
              "div",
              { className: "mt-8" },
              React.createElement("h2", { className: "text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-4" }, "History"),
              React.createElement(
                "div",
                { className: "glass-effect rounded-lg p-6 max-h-32 overflow-auto scrollbar-custom" },
                commandHistory.length === 0
                  ? React.createElement("p", { className: "text-base text-gray-500 dark:text-gray-400" }, "No device info fetched yet.")
                  : commandHistory.map((entry, index) =>
                      React.createElement(
                        "div",
                        { key: index, className: "mb-3 p-3 glass-effect rounded-lg" },
                        React.createElement(
                          "p",
                          { className: "text-base font-semibold text-gray-900 dark:text-gray-100" },
                          "Read Device Info",
                          " ",
                          React.createElement("span", { className: "text-sm text-gray-600 dark:text-gray-400" }, `(${entry.timestamp})`)
                        ),
                        React.createElement("p", { className: "text-sm text-gray-700 dark:text-gray-300 truncate" }, entry.output.slice(0, 80) + "...")
                      )
                    )
              )
            )
          )
        )
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById("root"));
  </script>
</body>
</html>
