<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebADB Pro GUI</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/webadb/webadb.js@master/webadb.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #10b981;
      --dark-bg: #1f2937;
      --darker-bg: #111827;
      --light-bg: #f9fafb;
      --lighter-bg: #ffffff;
      --text-dark: #1f2937;
      --text-light: #f9fafb;
      --border-dark: #374151;
      --border-light: #e5e7eb;
    }

    body {
      transition: all 0.3s ease;
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
    
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    
    .window {
      resize: both;
      overflow: auto;
      min-width: 500px;
      min-height: 600px;
      max-width: 90vw;
      max-height: 85vh;
      background: var(--lighter-bg);
      border: 1px solid var(--border-light);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      border-radius: 12px;
    }
    
    .dark .window {
      background: var(--darker-bg);
      border: 1px solid var(--border-dark);
    }
    
    .draggable-header {
      cursor: move;
      user-select: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    
    .scrollbar-custom::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(229, 231, 235, 0.4);
      border-radius: 4px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(107, 114, 128, 0.6);
      border-radius: 4px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(75, 85, 99, 0.8);
    }
    
    .dark .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(31, 41, 55, 0.4);
    }
    
    .dark .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(156, 163, 175, 0.6);
    }
    
    .dark .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(209, 213, 219, 0.8);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
    }
    
    .dark .glass-effect {
      background: rgba(31, 41, 55, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      transition: all 0.2s ease;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--primary-dark), #4338ca);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--secondary), #059669);
      color: white;
      transition: all 0.2s ease;
    }
    
    .btn-success:hover:not(:disabled) {
      background: linear-gradient(135deg, #059669, #047857);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
    }
    
    .status-connected {
      color: var(--secondary);
      font-weight: 600;
    }
    
    .status-disconnected {
      color: #ef4444;
      font-weight: 600;
    }
    
    .output-terminal {
      background: var(--dark-bg);
      color: var(--text-light);
      font-family: 'Cascadia Code', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      border-radius: 8px;
      padding: 1rem;
      height: 220px;
      overflow: auto;
    }
    
    .history-panel {
      max-height: 120px;
      overflow-y: auto;
    }
    
    .tab-active {
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
      font-weight: 600;
    }
    
    .dark .tab-active {
      color: var(--primary-dark);
      border-bottom: 2px solid var(--primary-dark);
    }

    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* منع إعادة التوجيه التلقائي */
    form {
      display: flex;
    }
    
    .command-input {
      flex: 1;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div id="root"></div>

  <script>
    const { useState, useEffect, useRef } = React;

    function App() {
      const [deviceStatus, setDeviceStatus] = useState("غير متصل");
      const [output, setOutput] = useState("");
      const [adb, setAdb] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState("");
      const [commandHistory, setCommandHistory] = useState([]);
      const [darkMode, setDarkMode] = useState(false); // الوضع الفاتح افتراضيًا
      const [activeTab, setActiveTab] = useState("info");
      const [shellCommand, setShellCommand] = useState("");
      const windowRef = useRef(null);

      // تحميل وضع الألوان من التخزين المحلي إذا كان موجوداً
      useEffect(() => {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme) {
          setDarkMode(savedTheme === "dark");
        }
      }, []);

      // تطبيق وضع الألوان
      useEffect(() => {
        document.body.classList.toggle("dark", darkMode);
        localStorage.setItem("theme", darkMode ? "dark" : "light");
      }, [darkMode]);

      const connectDevice = async () => {
        setLoading(true);
        setError("");
        try {
          // استخدام WebADB.js بشكل صحيح
          const webusb = await Adb.open("WebUSB");
          const adbConnection = await webusb.connectAdb("host::");
          
          setAdb(adbConnection);
          setDeviceStatus("متصل");
          setOutput("تم الاتصال بالجهاز بنجاح. انقر على 'قراءة المعلومات' لعرض تفاصيل الجهاز.");
        } catch (err) {
          setError(`فشل الاتصال: ${err.message}. تأكد من تمكين تصحيح USB وأن الجهاز متصل عبر USB.`);
          setDeviceStatus("غير متصل");
          setOutput("");
        } finally {
          setLoading(false);
        }
      };

      const runReadInfo = async () => {
        if (!adb) {
          setError("لا يوجد جهاز متصل. يرجى الاتصال بجهاز أولاً.");
          return;
        }
        setLoading(true);
        setError("");
        try {
          // استخدام WebADB.js لتنفيذ الأمر
          const shell = await adb.shell("getprop");
          const result = await shell.receive();
          const outputText = result.data || "لم يتم استقبال أي معلومات من الجهاز.";
          setOutput(outputText);
          setCommandHistory((prev) => [
            ...prev.slice(-9),
            { command: "getprop", output: outputText, timestamp: new Date().toLocaleTimeString() },
          ]);
        } catch (err) {
          setError(`فشل في قراءة معلومات الجهاز: ${err.message}`);
          setOutput(`خطأ: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const runShellCommand = async (command) => {
        if (!adb) {
          setError("لا يوجد جهاز متصل. يرجى الاتصال بجهاز أولاً.");
          return;
        }
        setLoading(true);
        try {
          const shell = await adb.shell(command);
          const result = await shell.receive();
          const outputText = result.data || "تم تنفيذ الأمر بنجاح.";
          setOutput(outputText);
          setCommandHistory((prev) => [
            ...prev.slice(-9),
            { command, output: outputText, timestamp: new Date().toLocaleTimeString() },
          ]);
          setError("");
        } catch (err) {
          setError(`فشل في تنفيذ الأمر: ${err.message}`);
          setOutput(`خطأ: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const handleShellSubmit = (e) => {
        e.preventDefault(); // هذا السطر يمنع إعادة تحميل الصفحة
        if (shellCommand.trim()) {
          runShellCommand(shellCommand.trim());
          setShellCommand("");
        }
      };

      // أوامر ADB شائعة الاستخدام
      const commonCommands = [
        { command: "getprop", description: "عرض خصائص النظام" },
        { command: "pm list packages", description: "عرض التطبيقات المثبتة" },
        { command: "dumpsys battery", description: "عرض حالة البطارية" },
        { command: "settings list system", description: "عرض إعدادات النظام" }
      ];

      return React.createElement(
        "div",
        { className: "min-h-screen flex items-center justify-center p-6" },
        React.createElement(
          "div",
          {
            ref: windowRef,
            className: "window rounded-xl w-[800px] h-[700px] relative animate-fadeIn",
            style: { position: "absolute", top: "5%", left: "50%", transform: "translateX(-50%)" },
          },
          React.createElement(
            "div",
            { className: "draggable-header p-4 flex justify-between items-center" },
            React.createElement("div", { className: "flex items-center space-x-2" },
              React.createElement("div", { className: "w-6 h-6 rounded-full bg-white/20 flex items-center justify-center" }, "🔧"),
              React.createElement("span", { className: "font-bold text-lg text-white" }, "WebADB Pro")
            ),
            React.createElement(
              "div",
              { className: "flex items-center space-x-3" },
              React.createElement(
                "button",
                {
                  onClick: () => setDarkMode(!darkMode),
                  className: "p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all duration-300 text-white",
                  title: darkMode ? "التغيير إلى الوضع الفاتح" : "التغيير إلى الوضع الداكن",
                },
                darkMode ? "☀️" : "🌙"
              )
            )
          ),
          React.createElement(
            "div",
            { className: "p-6 flex flex-col h-full" },
            React.createElement(
              "div",
              { className: "flex justify-between items-center mb-6" },
              React.createElement(
                "button",
                {
                  onClick: connectDevice,
                  disabled: loading || deviceStatus === "متصل",
                  className: `px-6 py-3 rounded-lg font-semibold transition-all duration-300 ${
                    deviceStatus === "متصل" 
                      ? "btn-success" 
                      : "btn-primary"
                  } disabled:opacity-50 disabled:cursor-not-allowed ${loading || deviceStatus !== "متصل" ? "animate-pulse" : ""}`,
                },
                loading ? React.createElement(React.Fragment, null, 
                  React.createElement("div", { className: "loading-spinner" }),
                  "جاري الاتصال..."
                ) : deviceStatus === "متصل" ? "متصل" : "الاتصال بالجهاز"
              ),
              React.createElement(
                "div",
                { className: "flex items-center" },
                React.createElement("div", { 
                  className: `w-3 h-3 rounded-full mr-2 ${deviceStatus === "متصل" ? "bg-green-500" : "bg-red-500"}`
                }),
                React.createElement(
                  "span",
                  { className: `text-lg font-medium ${deviceStatus === "متصل" ? "status-connected" : "status-disconnected"}` },
                  `الحالة: ${deviceStatus}`
                )
              )
            ),
            
            error && React.createElement(
              "div", 
              { className: "mb-6 p-3 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-lg animate-fadeIn" },
              React.createElement("p", { className: "text-red-700 dark:text-red-300" }, error)
            ),
            
            React.createElement(
              "div",
              { className: "mb-6 flex border-b border-gray-200 dark:border-gray-700" },
              React.createElement(
                "button",
                {
                  onClick: () => setActiveTab("info"),
                  className: `px-4 py-2 font-medium ${activeTab === "info" ? "tab-active" : "text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,
                },
                "معلومات الجهاز"
              ),
              React.createElement(
                "button",
                {
                  onClick: () => setActiveTab("shell"),
                  className: `px-4 py-2 font-medium ${activeTab === "shell" ? "tab-active" : "text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,
                },
                "سطر الأوامر"
              )
            ),
            
            activeTab === "info" && React.createElement(
              React.Fragment,
              null,
              React.createElement(
                "div",
                { className: "mb-6" },
                React.createElement(
                  "button",
                  {
                    onClick: runReadInfo,
                    disabled: loading || !adb,
                    className: "w-full px-6 py-4 glass-effect rounded-lg text-lg font-semibold text-gray-900 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",
                  },
                  loading ? React.createElement(React.Fragment, null, 
                    React.createElement("div", { className: "loading-spinner" }),
                    "جاري القراءة..."
                  ) : "قراءة معلومات الجهاز"
                )
              ),
              React.createElement(
                "div",
                { className: "flex-1 mb-6" },
                React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "المخرجات"),
                React.createElement(
                  "pre",
                  { className: "output-terminal scrollbar-custom" },
                  output || "اتصل بجهاز وانقر على 'قراءة معلومات الجهاز' لعرض التفاصيل."
                )
              )
            ),
            
            activeTab === "shell" && React.createElement(
              React.Fragment,
              null,
              React.createElement(
                "form",
                { onSubmit: handleShellSubmit, className: "mb-6" },
                React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "أمر مخصص"),
                React.createElement("div", { className: "flex" },
                  React.createElement("input", {
                    type: "text",
                    value: shellCommand,
                    onChange: (e) => setShellCommand(e.target.value),
                    placeholder: "أدخل أمر ADB (مثل: pm list packages)",
                    disabled: !adb,
                    className: "command-input px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-l-lg text-gray-900 dark:text-gray-100 disabled:opacity-50"
                  }),
                  React.createElement(
                    "button",
                    {
                      type: "submit",
                      disabled: !adb || !shellCommand.trim(),
                      className: "px-4 py-2 bg-blue-500 dark:bg-blue-600 text-white rounded-r-lg disabled:opacity-50 disabled:cursor-not-allowed"
                    },
                    "تنفيذ"
                  )
                )
              ),
              React.createElement(
                "div",
                { className: "mb-6" },
                React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "أوامر سريعة"),
                React.createElement("div", { className: "grid grid-cols-2 gap-2" },
                  commonCommands.map((cmd, index) => 
                    React.createElement(
                      "button",
                      {
                        key: index,
                        onClick: () => runShellCommand(cmd.command),
                        disabled: !adb,
                        className: "p-3 bg-gray-100 dark:bg-gray-800 rounded-lg text-right hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 transition-all duration-200",
                      },
                      React.createElement("div", { className: "font-medium text-gray-900 dark:text-gray-100" }, cmd.command),
                      React.createElement("div", { className: "text-sm text-gray-600 dark:text-gray-400" }, cmd.description)
                    )
                  )
                )
              ),
              React.createElement(
                "div",
                { className: "flex-1 mb-6" },
                React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "المخرجات"),
                React.createElement(
                  "pre",
                  { className: "output-terminal scrollbar-custom" },
                  output || "سيظهر ناتج الأمر هنا بعد التنفيذ."
                )
              )
            ),
            
            React.createElement(
              "div",
              { className: "mt-auto" },
              React.createElement("h2", { className: "text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3" }, "السجل"),
              React.createElement(
                "div",
                { className: "glass-effect rounded-lg p-4 history-panel scrollbar-custom" },
                commandHistory.length === 0
                  ? React.createElement("p", { className: "text-gray-500 dark:text-gray-400" }, "لا توجد أوامر منفذة بعد.")
                  : commandHistory.map((entry, index) =>
                      React.createElement(
                        "div",
                        { key: index, className: "mb-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700" },
                        React.createElement(
                          "div",
                          { className: "flex justify-between items-center mb-1" },
                          React.createElement(
                            "span",
                            { className: "text-sm font-semibold text-gray-900 dark:text-gray-100" },
                            entry.command
                          ),
                          React.createElement(
                            "span",
                            { className: "text-xs text-gray-500 dark:text-gray-400" },
                            entry.timestamp
                          )
                        ),
                        React.createElement("pre", { className: "text-xs text-gray-600 dark:text-gray-300 truncate" }, 
                          entry.output.slice(0, 80) + (entry.output.length > 80 ? "..." : ""))
                      )
                    )
              )
            )
          )
        )
      );
    }

    // تهيئة وتصيير التطبيق
    ReactDOM.render(React.createElement(App), document.getElementById("root"));
  </script>
</body>
</html>
