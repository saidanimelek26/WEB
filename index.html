<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebADB GUI</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/webadb/webadb.js@master/webadb.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.js"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out;
    }
    .window {
      resize: both;
      overflow: auto;
      min-width: 300px;
      min-height: 200px;
      max-width: 90vw;
      max-height: 80vh;
    }
    .draggable-header {
      cursor: move;
      user-select: none;
    }
    .scrollbar-custom::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .scrollbar-custom::-webkit-scrollbar-track {
      background: #e5e7eb;
    }
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: #6b7280;
      border-radius: 4px;
    }
    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: #4b5563;
    }
    .dark .scrollbar-custom::-webkit-scrollbar-track {
      background: #1f2937;
    }
    .dark .scrollbar-custom::-webkit-scrollbar-thumb {
      background: #9ca3af;
    }
    .dark .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }
  </style>
</head>
<body class="bg-gray-200 dark:bg-gray-900 transition-colors duration-300">
  <div id="root"></div>
  <script>
    const { useState, useEffect, useRef } = React;

    const adbCommands = [
      { command: "uname -a", description: "System Info" },
      { command: "ls -l", description: "List Directory" },
      { command: "ps", description: "Processes" },
      { command: "top", description: "Active Processes" },
      { command: "getprop", description: "Device Properties" },
      { command: "dmesg", description: "Kernel Logs" },
      { command: "logcat -d", description: "System Logs" },
    ];

    function App() {
      const [deviceStatus, setDeviceStatus] = useState("Disconnected");
      const [output, setOutput] = useState("");
      const [customCommand, setCustomCommand] = useState("");
      const [adb, setAdb] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState("");
      const [commandHistory, setCommandHistory] = useState([]);
      const [darkMode, setDarkMode] = useState(true);
      const windowRef = useRef(null);

      useEffect(() => {
        document.body.classList.toggle("dark", darkMode);
        localStorage.setItem("theme", darkMode ? "dark" : "light");
      }, [darkMode]);

      useEffect(() => {
        const window = windowRef.current;
        if (!window) return;
        let offsetX, offsetY;
        const handleDrag = (e) => {
          if (e.target.classList.contains("draggable-header")) {
            e.preventDefault();
            offsetX = e.clientX - window.offsetLeft;
            offsetY = e.clientY - window.offsetTop;
            const onMouseMove = (e) => {
              window.style.left = `${e.clientX - offsetX}px`;
              window.style.top = `${e.clientY - offsetY}px`;
            };
            document.addEventListener("mousemove", onMouseMove);
            document.addEventListener("mouseup", () => document.removeEventListener("mousemove", onMouseMove), { once: true });
          }
        };
        window.addEventListener("mousedown", handleDrag);
        return () => window.removeEventListener("mousedown", handleDrag);
      }, []);

      const connectDevice = async () => {
        setLoading(true);
        setError("");
        try {
          const webusb = await Adb.open("WebUSB");
          const adbConnection = await webusb.connectAdb("host::");
          setAdb(adbConnection);
          setDeviceStatus("Connected");
        } catch (err) {
          setError(`Connection failed: ${err.message}`);
          setDeviceStatus("Disconnected");
        } finally {
          setLoading(false);
        }
      };

      const runCommand = async (command) => {
        if (!adb) {
          setError("No device connected. Please connect a device first.");
          return;
        }
        setLoading(true);
        setError("");
        try {
          const shell = await adb.shell(command);
          const result = await shell.receive();
          const outputText = result.data || result;
          setOutput(outputText);
          setCommandHistory((prev) => [
            ...prev.slice(-9),
            { command, output: outputText, timestamp: new Date().toLocaleTimeString() },
          ]);
        } catch (err) {
          setError(`Command failed: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const handleCustomCommand = (e) => {
        e.preventDefault();
        if (customCommand.trim()) {
          runCommand(customCommand);
          setCustomCommand("");
        }
      };

      return React.createElement(
        "div",
        { className: "min-h-screen flex items-center justify-center p-4" },
        React.createElement(
          "div",
          {
            ref: windowRef,
            className: "window bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-300 dark:border-gray-700 w-[800px] h-[600px] relative animate-fadeIn",
            style: { position: "absolute", top: "10%", left: "20%" },
          },
          React.createElement(
            "div",
            { className: "draggable-header bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 p-2 flex justify-between items-center" },
            React.createElement("span", { className: "font-semibold" }, "WebADB GUI"),
            React.createElement(
              "div",
              null,
              React.createElement(
                "button",
                {
                  onClick: () => setDarkMode(!darkMode),
                  className: "p-1 rounded-full hover:bg-gray-400 dark:hover:bg-gray-600 transition-all duration-200",
                },
                darkMode ? "â˜€ï¸" : "ðŸŒ™"
              )
            )
          ),
          React.createElement(
            "div",
            { className: "p-4 flex flex-col h-full" },
            React.createElement(
              "div",
              { className: "flex justify-between mb-4" },
              React.createElement(
                "button",
                {
                  onClick: connectDevice,
                  disabled: loading || deviceStatus === "Connected",
                  className: `px-4 py-2 rounded-lg font-medium text-white transition-all duration-200 ${
                    deviceStatus === "Connected" ? "bg-green-600" : "bg-blue-600 hover:bg-blue-700"
                  } disabled:opacity-50 animate-fadeIn`,
                },
                loading ? "Connecting..." : deviceStatus === "Connected" ? "Connected" : "Connect Device"
              ),
              React.createElement(
                "span",
                { className: `text-sm ${deviceStatus === "Connected" ? "text-green-600" : "text-red-600"}` },
                `Status: ${deviceStatus}`
              )
            ),
            error && React.createElement("p", { className: "text-sm text-red-500 mb-4 animate-fadeIn" }, error),
            React.createElement(
              "div",
              { className: "mb-4" },
              React.createElement("h2", { className: "text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2" }, "Command Palette"),
              React.createElement(
                "div",
                { className: "grid grid-cols-2 sm:grid-cols-3 gap-2" },
                adbCommands.map(({ command, description }) =>
                  React.createElement(
                    "button",
                    {
                      key: command,
                      onClick: () => runCommand(command),
                      disabled: loading || !adb,
                      className:
                        "p-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-left text-sm transition-all duration-200 disabled:opacity-50 animate-fadeIn",
                    },
                    React.createElement("span", { className: "font-medium text-gray-800 dark:text-gray-200" }, command),
                    React.createElement("p", { className: "text-xs text-gray-500 dark:text-gray-400" }, description)
                  )
                )
              )
            ),
            React.createElement(
              "div",
              { className: "mb-4" },
              React.createElement("h2", { className: "text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2" }, "Custom Command"),
              React.createElement(
                "div",
                { className: "flex space-x-2" },
                React.createElement("input", {
                  type: "text",
                  value: customCommand,
                  onChange: (e) => setCustomCommand(e.target.value),
                  placeholder: "Enter ADB command (e.g., pm list packages)",
                  className:
                    "flex-1 p-2 border rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200",
                }),
                React.createElement(
                  "button",
                  {
                    onClick: handleCustomCommand,
                    disabled: loading || !adb,
                    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-all duration-200",
                  },
                  "Run"
                )
              )
            ),
            React.createElement(
              "div",
              { className: "flex-1" },
              React.createElement("h2", { className: "text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2" }, "Terminal Output"),
              React.createElement(
                "pre",
                { className: "bg-gray-800 text-gray-200 p-4 rounded-lg h-full overflow-auto scrollbar-custom font-mono text-sm" },
                output || "Run a command to see output here."
              )
            ),
            React.createElement(
              "div",
              { className: "mt-4" },
              React.createElement("h2", { className: "text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2" }, "Command History"),
              React.createElement(
                "div",
                { className: "bg-white dark:bg-gray-800 rounded-lg p-4 max-h-40 overflow-auto scrollbar-custom" },
                commandHistory.length === 0
                  ? React.createElement("p", { className: "text-sm text-gray-500 dark:text-gray-400" }, "No commands executed yet.")
                  : commandHistory.map((entry, index) =>
                      React.createElement(
                        "div",
                        { key: index, className: "mb-2 p-2 border-b border-gray-200 dark:border-gray-700" },
                        React.createElement(
                          "p",
                          { className: "text-sm font-medium text-gray-800 dark:text-gray-200" },
                          entry.command,
                          " ",
                          React.createElement("span", { className: "text-xs text-gray-500 dark:text-gray-400" }, `(${entry.timestamp})`)
                        ),
                        React.createElement("p", { className: "text-xs text-gray-600 dark:text-gray-400 truncate" }, entry.output.slice(0, 100) + "...")
                      )
                    )
              )
            )
          )
        )
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById("root"));
  </script>
</body>
</html>